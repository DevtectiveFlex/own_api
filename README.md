# API — Danruk Games

Backend API для проекта **Danruk Games**.  
Отвечает за предоставление данных для админки ведущего и экрана показа,
а также за агрегацию и чтение данных из базы.

Telegram-бот **НЕ использует API как обязательный слой** и работает
напрямую с базой данных.

---

## Назначение API

API используется для:

- админки ведущего (подготовка игр, вопросов, раундов)
- экрана показа (read-only представление состояния игры)
- получения агрегированных и подготовленных данных
- изоляции бизнес-логики чтения от фронтенда

API **не является владельцем состояния игры**.

---

## Архитектурные принципы

- Слоистая архитектура
- Чёткое разделение ответственности
- Отсутствие бизнес-логики в HTTP-слое
- Отсутствие прямого доступа к БД из API-эндпоинтов
- Подготовка к serverless-деплою

---

## Стек технологий

- Node.js
- Nitro (h3)
- TypeScript
- Supabase
- @supabase/supabase-js

---

## Структура проекта

```
server/
├─ api/                # HTTP слой (Nitro endpoints)
│  └─ users/
│     └─ [telegramId].get.ts
│
├─ services/           # Бизнес-логика
│  └─ users.service.ts
│
├─ db/                 # Слой доступа к данным
│  ├─ supabase.ts
│  └─ users/
│     └─ users.repo.ts
│
├─ domain/             # Доменные типы и контракты
│  └─ user.ts
│
└─ config/             # Конфигурация окружения
```

---

## Слои приложения

### API (`server/api`)
- HTTP-эндпоинты
- Парсинг параметров и тела запроса
- Валидация входных данных
- Маппинг ошибок в HTTP-ответы

### Services (`server/services`)
- Бизнес-логика
- Правила и сценарии
- Оркестрация репозиториев
- Не зависят от HTTP

### DB / Repository (`server/db`)
- Доступ к Supabase
- CRUD-операции
- Без бизнес-логики

### Domain (`server/domain`)
- Типы и интерфейсы
- Контракты предметной области
- Не зависят от инфраструктуры

---

## Переменные окружения

Файл `.env.example` содержит список обязательных переменных:

```
SUPABASE_URL=
SUPABASE_SERVICE_ROLE_KEY=
SUPABASE_PUBLIC_ROLE_KEY=
```

---

## Локальный запуск

```bash
npm install
npm run dev
```

---

## Взаимодействие с другими сервисами

- Telegram-бот работает напрямую с базой данных
- API и бот не зависят друг от друга
- Общая точка истины — база данных

---

## Статус проекта

Проект находится в активной разработке.
